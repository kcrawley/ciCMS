
<script src="resources/public/javascript/jquery-1.8.2.js"></script>

<script type="text/javascript">
   $(document).ready(function() {
    //url = 'http://qa.res-x.com/ws/r2/resonance.aspx?appid=jtv01&callback=devstest&trackingid=58&sessionid=25&event=product&scheme=product_rr&number=5&itemid=NKB115';
    
    $(document).on("click", "div.back .flower-power", function() {
        csrc = $(this).attr("src");
        calt = $(this).attr("alt");
        curl = $(this).attr("url");
        cprc = $(this).attr("price");
        nsrc = $("div.initial img.flower-power").attr("src");
        nalt = $("div.initial img.flower-power").attr("alt");
        nurl = $("div.initial img.flower-power").attr("url");
        nprc = $("div.initial img.flower-power").attr("price");
        $("div.initial img.flower-power").attr("src", csrc).attr("url", curl).attr("alt", calt).attr("price", cprc);
        $(this).attr("src", nsrc).attr("url", nurl).attr("alt", nalt).attr("price", nprc);
        
        prodDetails({
            desc: calt, 
            price: cprc, 
            prodUrl: curl
        });
    })
    
    $(document).on("click", ".recommend", function() {
        getProduct($(this).attr("pid"), 10);
    });
    
    $("#search_prod").submit(function() {
        getProduct($("#prod_id").val(), 10);
        $("#prod_id").val('');
        return false;
    });
    
    function formatCurrency(num) {
        num = isNaN(num) || num === '' || num === null ? 0.00 : num;
        return parseFloat(num).toFixed(2);
    }
    
    function prodDetails(data)
    {
        $("#prod-layout").empty().html("<h1>Product Details</h1>");
        $("#prod-layout").append("<ul><li><span class=\"prod-desc\">" + data.desc + "</span><li><li class=\"price\">$" + formatCurrency(data.price) + "</li><li  class=\"click-link\"><a target=\"blank\" href=\"" + data.prodUrl + "\"><button>View Product Page</button></a></li></li></ul>");
    }
    
    function getProduct(id, num)
    {
        console.log(id);
        $.ajax({
            url: 'http://qa.res-x.com/ws/r2/resonance.aspx',
            data: {
                appid: "jtv01", 
                callback: "devstest", 
                trackingid: 32, 
                sessionid: 85, 
                event: "product", 
                scheme: "product_rr", 
                number: num, 
                itemid: id
            },
            dataType: "jsonp",
            jsonpCallback: "devstest",
            success: function(data) {
               
                for (var i=0;i<5;i++)
                {
                    var b = '<div class=\"back\">';
                    var c = '</div>';
                    if (i<1) {
                        $("#image-flower").empty(); 
                        b = "<div class=\"initial inner-box-shadow\">";
                    }
                    $("#image-flower").append(b + "<img class=\"flower-power\" price=\"" + formatCurrency(data.schemes[0].products[i].price) + "\" url=\"" + data.schemes[0].products[i].prodUrl + "\" src=\"" + data.schemes[0].products[i].imgUrl + "\" alt=\"" + data.schemes[0].products[i].desc + "\" />" + c);
                }
                    
                $("#prod-recommend").html("<h2>Related Products</h2>");
                var list = $('<ul/>').appendTo("#prod-recommend");
                    
                $.each(data.schemes[0].products, function() {
                    list.append("<li><span class=\"prod-list-image\"><img class=\"box-shadow\" src=\"" + this.imgUrl + "\" alt=\"" + this.desc + "\" /></span><span class=\"prod-desc-link\">" + this.desc + "<br /><span class=\"list-price\">$" + formatCurrency(this.price) + "<br /></span><a class=\"recommend\" target=\"_blank\" href=\"" + this.prodUrl + "\"><button>Visit Product Page...</button></a></span></li>");
                });
                
                $("#prod-recommend").append("</ul>");
               
                prodDetails(data.schemes[0].products[0]);
                
            }
        })
    }
});
</script>

<header>
			<ul>
				<li class="logo">
					<a href="http://jtv.com"><img src="images/jtv_logo.png" class="main-logo" /></a>
					<div class="phone">800-581-3002</div>
				</li>
				<li class="paypal">
					<div class="paypal-top">Now Accepting</div>
					<a href="http://paypal.com"><img class="paypal-logo" src="images/paypal-transparent-logo.png" /></a>
					<span class="paypal-rside">What is PayPal?</span>
				</li>
				<li class="nav-search">
					<nav>
						<ul>
							<li><a href="#">cart</a></li>
							<li><a href="#">order status</a></li>
							<li><a href="#">my account</a></li>
						</ul>
					</nav>
					
					<div class="search">
						<form id="search_prod">
							<input type="text" id="prod_id" />
							<input type="submit" id="submit_search" value="Search">
						</form>
					</div>
				</li>
			</ul>
		</header>
		
		<article>
			<span id="image-flower">
			</span>
			
			<span id="prod-layout">
			</span>
			
			<div id="prod-recommend">
			</div>
		</article>
